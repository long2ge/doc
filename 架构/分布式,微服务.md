1.分布式

　　 微服务和分布式的区别

　　将一个大的系统划分为多个业务模块，业务模块分别部署到不同的机器上，各个业务模块之间通过接口进行数据交互。区别分布式的方式是根据不同机器不同业务。

　　上面：service A、B、C、D 分别是业务组件，通过API Geteway进行业务访问。

　　注：分布式需要做好事务管理。

　　2.分布式是否属于微服务？

　　答案是肯定的。微服务的意思也就是将模块拆分成一个独立的服务单元通过接口来实现数据的交互。

　　3.微服务架构

　　微服务的设计是为了不因为某个模块的升级和BUG影响现有的系统业务。微服务与分布式的细微差别是，微服务的应用不一定是分散在多个服务器上，他也可以是同一个服务器。

　 微服务和分布式的区别

　　分布式和微服的架构很相似，只是部署的方式不一样而已。

　　分布式服务架构与微服务架构概念的区别与联系是怎样的

　　分布式：分散压力。

　　微服务：分散能力。

　　当下理解

　　分布式：

　　不同模块部署在不同服务器上;

　　作用：分布式解决网站高并发带来问题;

　　集群：相同的服务;

　　多台服务器部署相同应用构成一个集群;

　　作用：通过负载均衡设备共同对外提供服务;

　　SOA［组装服务/ESB企业服务总线］;

　　业务系统分解为多个组件，让每个组件都独立提供离散，自治，可复用的服务能力;

　　通过服务的组合和编排来实现上层的业务流程;

　　作用：简化维护，降低整体风险，伸缩灵活;

　　微服务［找到服务/微服务网关open API］;

　　架构设计概念，各服务间隔离（分布式也是隔离），自治（分布式依赖整体组合）其它特性（单一职责，边界，异步通信，独立部署）是分布式概念的跟严格执行;

　　SOA到微服务架构的演进过程;

　　作用：各服务可独立应用，组合服务也可系统应用（巨石应用［monolith］的简化实现策略-平台思想）.






### Kong作为流量网关使用
1. 微服务网关就是一个系统,通过暴露该微服务网关系统,方便我们进行相关的鉴权,安全控制,日志统一处理,易于监控的相关功能
2. 
    $api_data = [
        'name' => 'live',
        'uris' => '/live.php', // 访问地址
        upstream_url' => '真实地址',
    ];
    $url = '网关地址';
    request($url, $api_data);
3. kong有大量的插件使用
3. 对Kong进行定制化开发，需要深度掌握OpenResty、Nginx、lua脚本等相关的知识，所以一般建议Kong作为流量网关使用。





微服务的利弊
利：
    1. 强模块化边界
    2. 可独立部署
    3. 技术多样性
弊：
    1. 分布式复杂性
    2. 最终一致性
    3. 运维复杂性
    4. 测试复杂性

康威法则：
第一定律：企业沟通方式会通过系统设计表达出来
第二定律：再多的时间也没办法让任务完美至极，但总有时间能将它完成
第三定律：线型系统和线型组织架构间有潜在的异质同态特性
第四定律：大系统比小系统更适用于任务分解


单机应用，前期开发效率高，微服务后期开发效率高。
建议刚刚开始使用单机应用，到达一个平衡点后使用微服务。

利用一切手段提高通信效率，如Slack、Github和Wiki，且只与相关人员进行沟通，每个人和每个系统必须有明确的职责，在遇到问题时，知道该找谁去解决。
在MVP模式下设计一套系统，以迭代的方式优化及验证，并确保系统的弹性。
采用与系统设计相一致的团队，以扁平化和以业务为基准的方式去简化团队，每个小团队之间必须有对应负责的模块，避免模糊的界限，以免在发生问题时互相推卸责任。
要做小而美的团队，人员数量的增加会降低效率以及加大成本，亚马逊CEO Jeff Bezos有个一个经验法则：如果两个披萨对于一个团队来说不够，那么这个团队就太大了。一般来说，一家互联网公司的产品团队由7到8个人组成（包括前端和后端测试、交互和用户体验师，一些人可能身兼数职）。





### 网关
### 网关的作用
1. 反向路由
2. 认证安全
3. 限流熔断
4. 日志监控
#### 主流的网关
1. zuul ：是 Netflix 开源的微服务⽹关，和 Eureka,Ribbon,Hystrix等组件配合使⽤，依赖组件⽐较多，性能教差
2. kong: 由 Mashape 公司开源的，基于 Nginx 的 API gateway
3. nginx+lua ：是⼀个⾼性能的 HTTP 和反向代理服务器 ,lua是脚本语⾔，让Nginx 执⾏ Lua 脚本，并且⾼并发、⾮阻塞 的处理各种请求
4. springcloud gateway: Spring 公司专⻔开发的⽹关，替代zuul


### 服务注册
：Zookeeper vs etcd vs Consul
zookeeper 是用 java 开发的，被 Apache 很多项目采用。

etcd 是用 go 开发的，主要是被 Kubernetes 采用。

zookeeper 非常稳定，是一个著名的分布式协调系统，etcd 是后起之秀，前景广阔。

因为 etcd 是用 go 写的，现在还没有很好的 java 客户端库，需要通过 http 方式调用。

而 zookeeper 在这方面就成熟很多，对于 java 之外的其他开发语言都有很好的客户端库。

具体选择 zookeeper 还是 etcd，需要根据您的需求结合它们各自的特性进行判断，还有您所使用的开发语言。


Redis用户分布式锁时，实现简单，市面上也有许多的开源框架。但是从根本上来说，它并不适合于分布式锁。因为分布式锁从业务场景上来说，是CP的，但Redis是AP的。

Zookeeper在实现分布式锁时，依靠的是创建临时节点和watch机制，它的效率和扩展能力都是比较低的，因此，也较少人使用。

etcd是一个Key/Value存储系统，但是它不同于Redis，在一致性和集群方面，借鉴了Zookeeper，使得它的集群能力和一致性能力都是比较强的。在使用方面，又采用restful API这种比较简单的使用方式，有点像ES。因此，我们发现，其实etcd是最适合用来做分布式锁的。



consul


相较于etcd、zookeeper，consul最大的特点就是：它整合了用户服务发现普遍的需求，开箱即用，降低了使用的门槛，并不需要任何第三方的工具。代码实现上也足够简单。




#### 配置中心
Disconf
2014年7月百度开源的配置管理中心，同样具备配置的管理能力，不过目前已经不维护了，最近的一次提交是两年前了。

Spring Cloud Config
2014年9月开源，Spring Cloud 生态组件，可以和Spring Cloud体系无缝整合。

Apollo
2016年5月，携程开源的配置管理中心，具备规范的权限、流程治理等特性。

Nacos
2018年6月，阿里开源的配置中心，也可以做DNS和RPC的服务发现。


### 治理
1. 配置集成
2. 后台服务集成，DB，MQ，Cache
3. 服务注册发现
4. 文档
5. 统一异常处理
6. 代码生成
7. 序列化 XML / JSON / 二进制
8. REST / RPC
9. 安全 & 访问控制
10. 断流熔断
11. 调用链埋点
12. Metrics
13. 日志
14. 软负载路由


### 监控
1. 端用户体验监控
    性能，返回码，城市，地区，运营商，版本，系统等
2. 业务监控
    核心指标监控，登陆注册，下单，支付等
3. 应用层监控
    url，sql，cache，service 可用率，响应时间，qps等
4. 系统层监控 - 物理机，虚拟机，os
    cpu，memory， network，disk等
5. 基础设施监控 - 网络，交换机
    网络流量，丢包，错包，，连接数等

日志监控，metrics监控，健康检查，调用链监控，警告系统。
Metrics作为一款监控指标的度量类库，提供了许多工具帮助开发者来完成各项数据的监控。


### Service Mesh
1. Linkerd：背后公司是Buoyant，开发语⾔使用Scala，2016年1⽉15日初次发布，2017年1⽉23日加入CNCF，2018年5⽉1⽇发布1.4.0版本。
2. Envoy：背后公司是Lyft，开发语言使用C++ 11，2016年9月13日初次发布，2017年9⽉14日加⼊CNCF，2018年3月21日发布1.6.0版本。
3. Istio：背后公司是Google和IBM，开发语言使用Go，2017年5⽉月10日初次发布，2018年3⽉31日发布0.7.1版本。
4. Conduit：背后公司也是Buoyant，开发语言使用Rust和Go，2017年12月5日初次发布，2018年4⽉27日发布0.4.1版本。


### 调用链监控
CAT、Open Zipkin和Naver Pinpoint是目前市场上主流的开源调用链监控产品