设计具备良好可扩展性的系统，有两个基本条件：正确预测变化、完美封装变化。


第一种应对变化的常见方案是将“变化”封装在一个“变化层”，将不变的部分封装在一个独立的“稳定层”。

1. 系统需要拆分出变化层和稳定层
2. 需要设计变化层和稳定层之间的接口

第二种常见的应对变化的方案是提炼出一个“抽象层”和一个“实现层”。抽象层是稳定的，实现层可以根据具体业务需要定制开发，当加入新的功能时，只需要增加新的实现，无须修改抽象层。






合适原则、简单原则、演化原则，架构设计时遵循这几个原则，有助于你做出最好的选择。


合适原则宣言：“合适优于业界领先”。
1. 将军难打无兵之仗
没那么多人，却想干那么多活，是失败的第一个主要原因。
2. 罗马不是一天建成的
没有那么多积累，却想一步登天，是失败的第二个主要原因。
3. 冰山下面才是关键
没有那么卓越的业务场景，却幻想灵光一闪成为天才，是失败的第三个主要原因。

简单原则宣言：“简单优于复杂”。
软件领域的复杂性体现在两个方面
1. 结构的复杂性
2. 逻辑的复杂性

演化原则宣言：“演化优于一步到位”。

首先，设计出来的架构要满足当时的业务需要。

其次，架构要不断地在实际应用过程中迭代，保留优秀的设计，修复有缺陷的设计，改正错误的设计，去掉无用的设计，使得架构逐渐完善。

第三，当业务发生变化时，架构要扩展、重构，甚至重写；代码也许会重写，但有价值的经验、教训、逻辑、设计等（类似生物体内的基因）却可以在新架构中延续。




架构设计第 1 步：识别复杂度
架构设计第 2 步：设计 3 ~ 5 个备选方案.
架构设计第 3 步：评估和选择备选方案
360 度环评：列出我们需要关注的质量属性点，然后分别从这些质量属性的维度去评估每个方案，再综合挑选适合当时情况的最优方案。
架构设计第 4 步：详细方案设计





FMEA方法，排除架构可用性隐患的利器
FMEA 方法
在架构设计领域，FMEA 的具体分析方法是：
给出初始的架构设计图。
假设架构中某个部件发生故障。
分析此故障对系统功能造成的影响。
根据分析结果，判断架构是否需要进行优化。

1.功能点
2.故障模式
3.故障影响
4.严重程度
5.故障原因
6.故障概率
7.风险程度
8.已有措施
9.规避措施
10.解决措施
11.后续规划



CAP
对于某些严苛的业务场景，例如和金钱相关的用户余额，或者和抢购相关的商品库存，技术上是无法做到分布式场景下完美的一致性的。而业务上必须要求一致性，因此单个用户的余额、单个商品的库存，理论上要求选择 CP 而实际上 CP 都做不到，只能选择 CA。也就是说，只能单点写入，其他节点做备份，无法做到分布式情况下多点写入。


CAP 理论告诉我们分布式系统只能选择 CP 或者 AP，但其实这里的前提是系统发生了“分区”现象。如果系统没有发生分区现象，也就是说 P 不存在的时候（节点间的网络连接一切正常），我们没有必要放弃 C 或者 A，应该 C 和 A 都可以保证，这就要求架构设计的时候既要考虑分区发生时选择 CP 还是 AP，也要考虑分区没有发生时如何保证 CA。



架构重构内功心法第一式：有的放矢
从一大堆纷繁复杂的问题中识别出真正要通过架构重构来解决的问题，集中力量快速解决，而不是想着通过架构重构来解决所有的问题。
架构重构内功心法第二式：合纵连横
在沟通协调时，将技术语言转换为通俗语言，以事实说话，以数据说话，是沟通的关键！

有效的策略是“换位思考、合作双赢、关注长期”。简单来说就是站在对方的角度思考，重构对他有什么好处，能够帮他解决什么问题，带来什么收益。

架构重构内功心法第三式：运筹帷幄
总结一下重构的做法，其实就是“分段实施”，将要解决的问题根据优先级、重要性、实施难度等划分为不同的阶段，每个阶段聚焦于一个整体的目标，集中精力和资源解决一类问题。




对于框架的选择，有一个总的原则：优选成熟的框架，避免盲目追逐新技术！



每个团队的人数不能多到两张披萨都不够吃的地步
一个微服务三个人负责开发。


拆分方法s
1. 基于业务逻辑拆分 例如 ： “商品”“交易”“用户”3 个服务
2. 基于可扩展拆分 例如： 稳定服务 or 变动服务
3. 基于可靠性拆分
将系统中的业务模块按照优先级排序，将可靠性要求高的核心服务和可靠性要求低的非核心服务拆分开来，然后重点保证核心服务的高可用。



可扩展的基本思想
基本思想都可以总结为一个字：拆！
面向流程拆分：将整个业务流程拆分为几个阶段，每个阶段作为一部分。

面向服务拆分：将系统提供的服务拆分，每个服务作为一部分。

面向功能拆分：将系统提供的功能拆分，每个功能作为一部分。
不同的拆分方式，本质上决定了系统的扩展方式。



1. 长参数的处理方法

一个模型（实体类 / 参数类）的封装应该是以行为为基础的